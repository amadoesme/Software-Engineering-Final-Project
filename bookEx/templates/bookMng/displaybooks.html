{% extends "base.html" %}
{% load static %}

{% block extra_css %}
   <link rel="stylesheet" href="{% static 'displaybook.css' %}">
{% endblock %}

{% block sidenav %}
   {% for item in item_list %}
      <li>
        <a href="{{ item.link }}">  {{ item.item }} </a>
      </li>
   {% endfor %}
    <li>
       <form action="{% url 'search_books' %}" method="get" class="nav-search" style="display:inline;">
          <input type="text" name="q" placeholder="Search books..." value="{{ request.GET.q|default:'' }}">
          <button type="submit">Search</button>
       </form>
    </li>
{% endblock sidenav %}

{% block content %}
    <h1>Display Books</h1>
   <table border="2" >
             <tr>
          <th>
              Book Name
          </th>
          <th>
              Book Price
          </th>
          <th>
              User Name
          </th>
          <th>
              Ratings
          </th>
      </tr>

   {% for book in books %}
      <tr>
         <td>
        <a href="book_detail/{{ book.id }}">  {{ book.name }} </a>
         </td>
         <td>
            {{ book.price }}
         </td>

          <td>
            {{ book.username }}
         </td>
         <td>
                                     {% if user.is_authenticated %}
                                        {% if book.username and book.username == user %}
                                           <div class="cannot-rate" style="font-size:0.9rem;margin-top:4px;color:#666;">You cannot rate your own book</div>
                                        {% else %}
                                           <div class="stars" aria-label="Rate {{ book.name }}">
                                              <form method="post" action="{% url 'book_rating' book.id %}" style="display:inline;">
                                                 {% csrf_token %}
                                                 <input type="hidden" name="value" value="1">
                                                 <button type="submit" class="star" title="Rate 1" style="background:none;border:none;padding:0;font-size:1.25rem;cursor:pointer;">★</button>
                                              </form>
                                              <form method="post" action="{% url 'book_rating' book.id %}" style="display:inline;">
                                                 {% csrf_token %}
                                                 <input type="hidden" name="value" value="2">
                                                 <button type="submit" class="star" title="Rate 2" style="background:none;border:none;padding:0;font-size:1.25rem;cursor:pointer;">★</button>
                                              </form>
                                              <form method="post" action="{% url 'book_rating' book.id %}" style="display:inline;">
                                                 {% csrf_token %}
                                                 <input type="hidden" name="value" value="3">
                                                 <button type="submit" class="star" title="Rate 3" style="background:none;border:none;padding:0;font-size:1.25rem;cursor:pointer;">★</button>
                                              </form>
                                              <form method="post" action="{% url 'book_rating' book.id %}" style="display:inline;">
                                                 {% csrf_token %}
                                                 <input type="hidden" name="value" value="4">
                                                 <button type="submit" class="star" title="Rate 4" style="background:none;border:none;padding:0;font-size:1.25rem;cursor:pointer;">★</button>
                                              </form>
                                              <form method="post" action="{% url 'book_rating' book.id %}" style="display:inline;">
                                                 {% csrf_token %}
                                                 <input type="hidden" name="value" value="5">
                                                 <button type="submit" class="star" title="Rate 5" style="background:none;border:none;padding:0;font-size:1.25rem;cursor:pointer;">★</button>
                                              </form>
                                           </div>
                                        {% endif %}
                                     {% else %}
                                        <div style="font-size:0.9rem;margin-top:4px;"><a href="{% url 'login' %}?next={% url 'displaybooks' %}">Log in to rate</a></div>
                                     {% endif %}
                     <div class="rating-summary" style="font-size:0.9rem;margin-top:4px;">
                        Average Rating: {% if book.avg_rating %}{{ book.avg_rating|floatformat:1 }}{% else %}&mdash;{% endif %} / 5 — out of {{ book.rating_count|default:0 }} reviews
                     </div>
                              {% if user.is_authenticated and user.is_superuser %}
                                 <div style="margin-top:6px;">
                                    <form method="post" action="{% url 'book_delete' book.id %}" style="display:inline;">
                                       {% csrf_token %}
                                       <button type="submit" style="background:#c00;color:#fff;border:none;padding:4px 8px;cursor:pointer;">Delete</button>
                                    </form>
                                 </div>
                              {% endif %}
         </td>


      </tr>
   {% endfor %}
   </table>
{% endblock content %}